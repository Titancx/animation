(function(global){var HASH_TAG="#";var unitCache={};var PREFIX_TYPE=["","webkit","moz","ms","o","Webkit","Moz","O"];var UNIT_REG=/^\d+([a-zA-Z]+)/;var currentVendor;function judgeVendor(){if(currentVendor){return}var property="transition";var supportElement=document.createElement("virtualDom");for(var key in PREFIX_TYPE){var prefixedProp=PREFIX_TYPE[key]+property.charAt(0).toUpperCase()+property.slice(1);if(prefixedProp in supportElement.style){currentVendor=PREFIX_TYPE[key];break}}}function isFunction(fn){return typeof fn==="function"}function isString(str){return Object.prototype.toString.call(str)==="[object String]"}function toFloat(num){num=parseFloat(num);if(isNaN(num)){num=0}return num}function isEmptyObject(e){if(Object.prototype.toString.call(e)!=="[object Object]"){return true}for(var t in e){return false}return true}function isHashTag(tag){var isHashTag=false;if(tag===HASH_TAG){isHashTag=true}return isHashTag}function needAnimation(item){var needAnimation=false;var style=getComputedStyle(item.ele);for(var key in item.property){if(item.property[key]!==style[key]){needAnimation=true;break}}if(!needAnimation&&item.fn){item.fn()}return needAnimation}function unitProperty(property,value,supportElement){if(value!==+value){return value}if(unitCache[property]){return value+unitCache[property]}supportElement.style[property]=0;var propValue=supportElement.style[property];var match=propValue.match&&propValue.match(UNIT_REG);if(match){return value+(unitCache[property]=match[1])}return value}function setVendorProperty(property,fn){var supportElement=document.createElement("virtualDom");var newProp=property;if(!(property in supportElement.style)){newProp=!currentVendor?currentVendor:currentVendor+property.charAt(0).toUpperCase()+property.slice(1)}fn(property,newProp)}function calculateProperty(ele,property,duration,easing,callback,delay,isAsync){for(var i=2;i<arguments.length;i++){if(isFunction(arguments[i])){callback=arguments[i];break}}duration=toFloat(duration)?toFloat(duration)/1000:0.4;easing=isString(easing)?easing:"linear";isAsync=toFloat(isAsync)?toFloat(isAsync):0;delay=toFloat(delay)?toFloat(delay)/1000:0;return{ele:ele,property:property,duration:duration,easing:easing,isAsync:isAsync,delay:delay,fn:callback}}function AnimationElement(){this.isRuning=false;this.asyncQueue=[];this.endCallBack=[]}AnimationElement.prototype._setAnimationTimeout=function(funRef,ele,delayTime){var obj={};obj.target=ele.ele;var bindFun=funRef.bind(this,obj,ele);ele.bindFun=bindFun;ele.timer=setTimeout(bindFun,delayTime)};AnimationElement.prototype._startRun=function(isExexuteNow){if(!this.isRuning&&isExexuteNow&&this.asyncQueue.length>0){this.isRuning=true;this._run()}};AnimationElement.prototype._run=function(){if(this.asyncQueue.length===0){return}for(var i=0;i<this.asyncQueue.length;i++){if(!isHashTag(this.asyncQueue[i])){if(needAnimation(this.asyncQueue[i])){this._addVendorEvent(this.asyncQueue[i],"transitionend");var outTime=this.asyncQueue[i].duration*1000+this.asyncQueue[i].delay*1000+25;this._setAnimationTimeout(this._handle,this.asyncQueue[i],outTime);this.asyncQueue[i].startTime=new Date().getTime();setVendorProperty("transition",function(oldProp,newProp){this.asyncQueue[i].ele.style[newProp]="all ".concat(this.asyncQueue[i].duration,"s ",this.asyncQueue[i].easing," ",this.asyncQueue[i].delay,"s")}.bind(this));for(var j in this.asyncQueue[i].property){this.asyncQueue[i].ele.style[j]=this.asyncQueue[i].property[j]}}else{this.asyncQueue.splice(i,1);if(isHashTag(this.asyncQueue[0])){this.isRuning=false;this.asyncQueue.shift()}this._run()}}else{break}}};AnimationElement.prototype._handle=function(event,obj){var now=new Date().getTime();if((now-obj.startTime)/1000>=obj.duration+obj.delay){this.isRuning=false;clearTimeout(obj.timer);this._removeVendorEvent(obj,"transitionend");var isAsync=this._deleteFinishElement(obj);if(isHashTag(this.asyncQueue[0])){if(isAsync){if(!!this.endCallBack[0]&&Object.prototype.toString.call(this.endCallBack[0])==="[object Function]"){this.endCallBack[0]()}this.endCallBack.shift()}this.asyncQueue.shift();this._startRun(1)}}};AnimationElement.prototype._addVendorEvent=function(el,prop){var obj={};obj.target=el.ele;var bindFun=this._handle.bind(this,obj,el);setVendorProperty(prop,function(oldProp,newProp){prop=newProp});el.ele.addEventListener(prop,bindFun);el.bindFun=bindFun};AnimationElement.prototype._removeVendorEvent=function(el,prop){setVendorProperty(prop,function(oldProp,newProp){prop=newProp});el.ele.removeEventListener(prop,el.bindFun)};AnimationElement.prototype._deleteFinishElement=function(ele){for(var i=0;i<this.asyncQueue.length;i++){var currentAnimationDom=this.asyncQueue[i];if(currentAnimationDom!==HASH_TAG&&this.asyncQueue[i]===ele){if(!!this.asyncQueue[i].fn){this.asyncQueue[i].fn()}var deleteNode=this.asyncQueue.splice(i,1);return deleteNode[0].isAsync}}return 0};AnimationElement.prototype._setInitializateProperty=function(propsObj){var supportElement=document.createElement("virtualDom");
for(var key in propsObj){setVendorProperty(key,function(oldProp,newProp){if(newProp!==oldProp){propsObj[newProp]=propsObj[oldProp];delete propsObj[oldProp]}});var props=unitProperty(key,propsObj[key],supportElement);propsObj[key]=props}};AnimationElement.prototype._pushDoms=function(ele,property,duration,easing,callback,delay,isAsync){var currentObj;if(ele.length>0){for(var i=0;i<ele.length;i++){if(ele[i] instanceof HTMLElement){this._pushToAsyncQueue(ele[i],property,duration,easing,callback,delay,1)}}}else{if(ele instanceof HTMLElement){this._pushToAsyncQueue(ele,property,duration,easing,callback,delay,isAsync)}}};AnimationElement.prototype._pushToAsyncQueue=function(ele,property,duration,easing,callback,delay,isAsync){var currentObj=calculateProperty(ele,property,duration,easing,callback,delay,isAsync);if(currentObj.isAsync){this.asyncQueue.push(currentObj)}else{this.asyncQueue.push(currentObj,HASH_TAG)}};AnimationElement.prototype.animate=function(ele,property,duration,easing,callback,delay,isAsync){if(!ele||isEmptyObject(property)){return this}this._setInitializateProperty(property);this._pushDoms(ele,property,duration,easing,callback,delay,isAsync);if(this.asyncQueue.length>0){this._startRun(!this.asyncQueue[0].isAsync)}return this};AnimationElement.prototype.endAnimation=function(fn){if(this.asyncQueue.length===0){return}this.endCallBack.push(fn);if(!isHashTag(this.asyncQueue[this.asyncQueue.length-1])){this.asyncQueue.push(HASH_TAG)}if(!this.isRuning){this._startRun(1)}return this};AnimationElement.prototype.stop=function(){this.isRuning=false;for(var i=0;i<this.asyncQueue.length;i++){var asycEvent=this.asyncQueue[i];if(!isHashTag(this.asyncQueue[i])){clearTimeout(asycEvent.timer);var style=getComputedStyle(asycEvent.ele);this._removeVendorEvent(asycEvent,"transitionend");setVendorProperty("transitionDuration",function(oldProp,newProp){asycEvent.ele.style[newProp]="0s"});for(var j in asycEvent.property){asycEvent.ele.style[j]=style[j]}}}this.asyncQueue=[];return this};function AnimationEntry(ele,property,duration,easing,callback,delay,isAsync){var animate=new AnimationElement();judgeVendor();animate.animate(ele,property,duration,easing,callback,delay,isAsync);return animate}global.animate=AnimationElement})(this);